language: swift

osx_image: xcode10.2
env:
  matrix:
    - TEST_SDK=iphonesimulator OS=12.2 NAME='iPhone 6'
    - TEST_SDK=iphonesimulator OS=11.4 NAME='iPhone 6'
    - TEST_SDK=iphonesimulator OS=10.3.1 NAME='iPhone 6'
    - TEST_SDK=iphonesimulator OS=9.3 NAME='iPhone 6'

sudo: required
cache: cocoapods
before_install:
  - sudo mkdir '/Library/Developer/CoreSimulator/Profiles/Runtimes/iOS 9.3.simruntime/Contents/Resources/RuntimeRoot/usr/lib/swift'
  - gem install cocoapods slather
  - pod install --repo-update

script:
  - set -o pipefail && xcodebuild test -enableCodeCoverage YES -workspace WRUserSettings.xcworkspace -scheme WRUserSettings -sdk $TEST_SDK -destination "platform=iOS Simulator,OS=$OS,name=$NAME" ONLY_ACTIVE_ARCH=YES | xcpretty
  - pod lib lint

after_success: 
  - slather
  - bash <(curl -s https://codecov.io/bash) -f reports/cobertura.xml -X coveragepy -X gcov -X xcode